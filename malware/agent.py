#!/usr/bin/env python3
"""
Agent responsible for:
- handling tamper operations
- creating manifest data
"""

from datetime import datetime
from pathlib import Path
import hashlib

MANIFEST_FILE = "manifest.log"

def file_hash(path: Path):
    """Return sha256 hash of a file or empty if unreadable."""
    try:
        content = path.read_bytes()
        return hashlib.sha256(content).hexdigest()
    except:
        return None

def record_manifest(victim_dir: Path, filepath: Path, action: str):
    """Append record to manifest file."""
    manifest = victim_dir / MANIFEST_FILE

    before = file_hash(filepath)
    ts = datetime.now().isoformat()

    entry = f"{ts} | {action} | {filepath.name} | hash={before}\n"

    with open(manifest, "a", encoding="utf-8") as f:
        f.write(entry)
